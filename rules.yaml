#- action: Terminate Pod
#  actionner: kubernetes:terminate

- action: Run a Wireshark capture
  actionner: kubernetes:script
  parameters:
    shell: /bin/bash
    script: |
      sudo tshark -i any -a duration:10 -w all-networks-capture.pcap

- action: Install Wireshark in Container
  actionner: kubernetes:script
  parameters:
    shell: /bin/bash
    script: |
      sudo apt update
      sudo apt install tshark -y

- action: Labelize Pod as Suspicious
  actionner: kubernetes:labelize
  parameters:
    labels:
      suspicious: true

- rule: Detect crypto miners using the Stratum protocol
  match:
    rules:
      - Detect crypto miners using the Stratum protocol
  actions:
    - action: Run a Wireshark capture
#    - action: Terminate Pod
#      parameters:
#        grace_period_seconds: 8

- rule: Terminal shell in container 
  match:
    rules:
      - Terminal shell in container
    output_fields:
      - k8s.ns.name!=kube-system, k8s.ns.name!=falco
  actions:
    - action: Labelize Pod as Suspicious
    - action: Install Wireshark in Container
